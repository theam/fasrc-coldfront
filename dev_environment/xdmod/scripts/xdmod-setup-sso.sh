#!/bin/bash

mkdir -p /etc/xdmod/simplesamlphp/{config,metadata,cert}

certString=`cat /etc/pki/tls/certs/localhost.crt | head -n-1 | tail -n+2 | tr -d '\n'`

cat << EOF > /etc/xdmod/simplesamlphp/metadata/saml20-idp-remote.php
<?php
/**
 * SAML 2.0 remote IdP metadata for SimpleSAMLphp.
 *
 * Remember to remove the IdPs you don't use from this file.
 *
 * See: https://simplesamlphp.org/docs/stable/simplesamlphp-reference-idp-remote
 */

\$metadata['xdmod-hosted-idp-dex'] = array (
  'metadata-set' => 'saml20-idp-remote',
  'entityid' => 'xdmod-hosted-idp-dex',
  'SingleSignOnService' =>
  array (
    0 =>
    array (
      'Binding' => 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect',
      'Location' => 'https://localhost:4443/simplesaml/saml2/idp/SSOService.php',
    ),
  ),
  'SingleLogoutService' =>
  array (
    0 =>
    array (
      'Binding' => 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect',
      'Location' => 'https://localhost:4443/simplesaml/saml2/idp/SingleLogoutService.php',
    ),
  ),
  'certData' => '$certString',
  'NameIDFormat' => 'urn:oasis:names:tc:SAML:2.0:nameid-format:transient',
  'icon' => <<< ICON
data:image/png;base64,
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
W/h+NOBMvRyhz5AAAAABJRU5ErkJggg==
ICON
);
EOF
